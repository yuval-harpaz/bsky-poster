{"version":3,"file":"recordkey.js","sourceRoot":"","sources":["../src/recordkey.ts"],"names":[],"mappings":";;;AAmBA,oDAkBC;AAED,4CAOC;AA5CD,MAAM,qBAAqB,GAAG,GAAG,CAAA;AACjC,MAAM,qBAAqB,GAAG,CAAC,CAAA;AAC/B,MAAM,yBAAyB,GAAG,IAAI,GAAG,CAAC,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC,CAAA;AACtD,MAAM,gBAAgB,GAAG,2BAA2B,CAAA;AAEpD,yDAAyD;AACzD,qFAAqF;AACrF,6EAA6E;AAC7E,gFAAgF;AAChF,oDAAoD;AACpD,4DAA4D;AAC5D,wEAAwE;AACxE,wCAAwC;AACxC,2EAA2E;AAC3E,6EAA6E;AAC7E,uEAAuE;AAEvE,SAAgB,oBAAoB,CAClC,IAAY;IAEZ,IACE,IAAI,CAAC,MAAM,GAAG,qBAAqB;QACnC,IAAI,CAAC,MAAM,GAAG,qBAAqB,EACnC,CAAC;QACD,MAAM,IAAI,qBAAqB,CAC7B,sBAAsB,qBAAqB,OAAO,qBAAqB,aAAa,CACrF,CAAA;IACH,CAAC;IACD,IAAI,yBAAyB,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC;QACxC,MAAM,IAAI,qBAAqB,CAAC,mCAAmC,CAAC,CAAA;IACtE,CAAC;IACD,sEAAsE;IACtE,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC;QACjC,MAAM,IAAI,qBAAqB,CAAC,qCAAqC,CAAC,CAAA;IACxE,CAAC;AACH,CAAC;AAED,SAAgB,gBAAgB,CAAC,IAAY;IAC3C,OAAO,CACL,IAAI,CAAC,MAAM,IAAI,qBAAqB;QACpC,IAAI,CAAC,MAAM,IAAI,qBAAqB;QACpC,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC;QAC3B,CAAC,yBAAyB,CAAC,GAAG,CAAC,IAAI,CAAC,CACrC,CAAA;AACH,CAAC;AAED,MAAa,qBAAsB,SAAQ,KAAK;CAAG;AAAnD,sDAAmD","sourcesContent":["export type RecordKeyString = string\n\nconst RECORD_KEY_MAX_LENGTH = 512\nconst RECORD_KEY_MIN_LENGTH = 1\nconst RECORD_KEY_INVALID_VALUES = new Set(['.', '..'])\nconst RECORD_KEY_REGEX = /^[a-zA-Z0-9_~.:-]{1,512}$/\n\n// https://atproto.com/specs/record-key#record-key-syntax\n// Regardless of the type, Record Keys must fulfill some baseline syntax constraints:\n// - restricted to a subset of ASCII characters -- the allowed characters are\n//   alphanumeric (A-Za-z0-9), period, dash, underscore, colon, or tilde (.-_:~)\n// - must have at least 1 and at most 512 characters\n// - the specific record key values . and .. are not allowed\n// - must be a permissible part of repository MST path string (the above\n//   constraints satisfy this condition)\n// - must be permissible to include in a path component of a URI (following\n//   RFC-3986, section 3.3). The above constraints satisfy this condition, by\n//   matching the \"unreserved\" characters allowed in generic URI paths.\n\nexport function ensureValidRecordKey(\n  rkey: string,\n): asserts rkey is RecordKeyString {\n  if (\n    rkey.length > RECORD_KEY_MAX_LENGTH ||\n    rkey.length < RECORD_KEY_MIN_LENGTH\n  ) {\n    throw new InvalidRecordKeyError(\n      `record key must be ${RECORD_KEY_MIN_LENGTH} to ${RECORD_KEY_MAX_LENGTH} characters`,\n    )\n  }\n  if (RECORD_KEY_INVALID_VALUES.has(rkey)) {\n    throw new InvalidRecordKeyError('record key can not be \".\" or \"..\"')\n  }\n  // simple regex to enforce most constraints via just regex and length.\n  if (!RECORD_KEY_REGEX.test(rkey)) {\n    throw new InvalidRecordKeyError('record key syntax not valid (regex)')\n  }\n}\n\nexport function isValidRecordKey(rkey: string): rkey is RecordKeyString {\n  return (\n    rkey.length >= RECORD_KEY_MIN_LENGTH &&\n    rkey.length <= RECORD_KEY_MAX_LENGTH &&\n    RECORD_KEY_REGEX.test(rkey) &&\n    !RECORD_KEY_INVALID_VALUES.has(rkey)\n  )\n}\n\nexport class InvalidRecordKeyError extends Error {}\n"]}